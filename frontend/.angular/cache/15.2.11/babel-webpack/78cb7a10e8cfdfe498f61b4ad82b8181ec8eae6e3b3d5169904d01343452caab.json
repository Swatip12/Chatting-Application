{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject } from 'rxjs';\nimport { tap, finalize } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./loading.service\";\nimport * as i3 from \"./notification.service\";\nexport class AuthService {\n  constructor(http, loadingService, notificationService) {\n    this.http = http;\n    this.loadingService = loadingService;\n    this.notificationService = notificationService;\n    this.apiUrl = 'http://localhost:8080/api';\n    this.currentUserSubject = new BehaviorSubject(null);\n    this.currentUser$ = this.currentUserSubject.asObservable();\n    // Load user from localStorage on service initialization\n    const storedUser = localStorage.getItem('currentUser');\n    if (storedUser) {\n      this.currentUserSubject.next(JSON.parse(storedUser));\n    }\n  }\n  register(userData) {\n    this.loadingService.setLoadingFor('register', true);\n    return this.http.post(`${this.apiUrl}/register`, userData).pipe(tap(response => {\n      if (response.success) {\n        this.notificationService.showSuccess('Registration successful! Please log in.');\n      }\n    }), finalize(() => {\n      this.loadingService.setLoadingFor('register', false);\n    }));\n  }\n  login(credentials) {\n    this.loadingService.setLoadingFor('login', true);\n    return this.http.post(`${this.apiUrl}/login`, credentials).pipe(tap(response => {\n      if (response.user) {\n        // Store user in localStorage\n        localStorage.setItem('currentUser', JSON.stringify(response.user));\n        this.currentUserSubject.next(response.user);\n        this.notificationService.showSuccess(`Welcome back, ${response.user.username}!`);\n      }\n    }), finalize(() => {\n      this.loadingService.setLoadingFor('login', false);\n    }));\n  }\n  logout() {\n    this.loadingService.setLoadingFor('logout', true);\n    // Call logout endpoint\n    this.http.post(`${this.apiUrl}/logout`, {}).subscribe({\n      next: () => {\n        this.clearUserData();\n        this.notificationService.showInfo('You have been logged out successfully.');\n      },\n      error: () => {\n        // Clear data even if logout request fails\n        this.clearUserData();\n        this.notificationService.showInfo('You have been logged out.');\n      },\n      complete: () => {\n        this.loadingService.setLoadingFor('logout', false);\n      }\n    });\n  }\n  clearUserData() {\n    localStorage.removeItem('currentUser');\n    this.currentUserSubject.next(null);\n  }\n  getCurrentUser() {\n    return this.currentUserSubject.value;\n  }\n  isAuthenticated() {\n    return this.getCurrentUser() !== null;\n  }\n  getUsers() {\n    return this.http.get(`${this.apiUrl}/users`);\n  }\n  getOnlineUsers() {\n    return this.http.get(`${this.apiUrl}/users/online`);\n  }\n  updateUserStatus(status) {\n    return this.http.put(`${this.apiUrl}/users/status`, {\n      status\n    });\n  }\n  getMessageHistory(userId) {\n    return this.http.get(`${this.apiUrl}/messages/${userId}`);\n  }\n  getGroupMessageHistory(groupId) {\n    return this.http.get(`${this.apiUrl}/messages/group/${groupId}`);\n  }\n  // HTTP interceptor helper methods\n  getAuthHeaders() {\n    const user = this.getCurrentUser();\n    if (user) {\n      return new HttpHeaders({\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${user.id}` // Simple user ID based auth for demo\n      });\n    }\n\n    return new HttpHeaders({\n      'Content-Type': 'application/json'\n    });\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.LoadingService), i0.ɵɵinject(i3.NotificationService));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["HttpHeaders","BehaviorSubject","tap","finalize","AuthService","constructor","http","loadingService","notificationService","currentUserSubject","asObservable","storedUser","localStorage","getItem","next","JSON","parse","register","userData","setLoadingFor","post","apiUrl","pipe","response","success","showSuccess","login","credentials","user","setItem","stringify","username","logout","subscribe","clearUserData","showInfo","error","complete","removeItem","getCurrentUser","value","isAuthenticated","getUsers","get","getOnlineUsers","updateUserStatus","status","put","getMessageHistory","userId","getGroupMessageHistory","groupId","getAuthHeaders","id","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\swatip\\Documents\\FSD Projects\\Chatting-Application\\frontend\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, BehaviorSubject } from 'rxjs';\r\nimport { tap, finalize } from 'rxjs/operators';\r\nimport { User, LoginRequest, RegisterRequest, AuthResponse } from '../models/user.model';\r\nimport { Message } from '../models/message.model';\r\nimport { LoadingService } from './loading.service';\r\nimport { NotificationService } from './notification.service';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class AuthService {\r\n    private apiUrl = 'http://localhost:8080/api';\r\n    private currentUserSubject = new BehaviorSubject<User | null>(null);\r\n    public currentUser$ = this.currentUserSubject.asObservable();\r\n\r\n    constructor(\r\n        private http: HttpClient,\r\n        private loadingService: LoadingService,\r\n        private notificationService: NotificationService\r\n    ) {\r\n        // Load user from localStorage on service initialization\r\n        const storedUser = localStorage.getItem('currentUser');\r\n        if (storedUser) {\r\n            this.currentUserSubject.next(JSON.parse(storedUser));\r\n        }\r\n    }\r\n\r\n    register(userData: RegisterRequest): Observable<AuthResponse> {\r\n        this.loadingService.setLoadingFor('register', true);\r\n        return this.http.post<AuthResponse>(`${this.apiUrl}/register`, userData)\r\n            .pipe(\r\n                tap((response: AuthResponse) => {\r\n                    if (response.success) {\r\n                        this.notificationService.showSuccess('Registration successful! Please log in.');\r\n                    }\r\n                }),\r\n                finalize(() => {\r\n                    this.loadingService.setLoadingFor('register', false);\r\n                })\r\n            );\r\n    }\r\n\r\n    login(credentials: LoginRequest): Observable<AuthResponse> {\r\n        this.loadingService.setLoadingFor('login', true);\r\n        return this.http.post<AuthResponse>(`${this.apiUrl}/login`, credentials)\r\n            .pipe(\r\n                tap((response: AuthResponse) => {\r\n                    if (response.user) {\r\n                        // Store user in localStorage\r\n                        localStorage.setItem('currentUser', JSON.stringify(response.user));\r\n                        this.currentUserSubject.next(response.user);\r\n                        this.notificationService.showSuccess(`Welcome back, ${response.user.username}!`);\r\n                    }\r\n                }),\r\n                finalize(() => {\r\n                    this.loadingService.setLoadingFor('login', false);\r\n                })\r\n            );\r\n    }\r\n\r\n    logout(): void {\r\n        this.loadingService.setLoadingFor('logout', true);\r\n        // Call logout endpoint\r\n        this.http.post(`${this.apiUrl}/logout`, {}).subscribe({\r\n            next: () => {\r\n                this.clearUserData();\r\n                this.notificationService.showInfo('You have been logged out successfully.');\r\n            },\r\n            error: () => {\r\n                // Clear data even if logout request fails\r\n                this.clearUserData();\r\n                this.notificationService.showInfo('You have been logged out.');\r\n            },\r\n            complete: () => {\r\n                this.loadingService.setLoadingFor('logout', false);\r\n            }\r\n        });\r\n    }\r\n\r\n    private clearUserData(): void {\r\n        localStorage.removeItem('currentUser');\r\n        this.currentUserSubject.next(null);\r\n    }\r\n\r\n    getCurrentUser(): User | null {\r\n        return this.currentUserSubject.value;\r\n    }\r\n\r\n    isAuthenticated(): boolean {\r\n        return this.getCurrentUser() !== null;\r\n    }\r\n\r\n    getUsers(): Observable<User[]> {\r\n        return this.http.get<User[]>(`${this.apiUrl}/users`);\r\n    }\r\n\r\n    getOnlineUsers(): Observable<User[]> {\r\n        return this.http.get<User[]>(`${this.apiUrl}/users/online`);\r\n    }\r\n\r\n    updateUserStatus(status: string): Observable<any> {\r\n        return this.http.put(`${this.apiUrl}/users/status`, { status });\r\n    }\r\n\r\n    getMessageHistory(userId: number): Observable<Message[]> {\r\n        return this.http.get<Message[]>(`${this.apiUrl}/messages/${userId}`);\r\n    }\r\n\r\n    getGroupMessageHistory(groupId: string): Observable<Message[]> {\r\n        return this.http.get<Message[]>(`${this.apiUrl}/messages/group/${groupId}`);\r\n    }\r\n\r\n    // HTTP interceptor helper methods\r\n    getAuthHeaders(): HttpHeaders {\r\n        const user = this.getCurrentUser();\r\n        if (user) {\r\n            return new HttpHeaders({\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${user.id}` // Simple user ID based auth for demo\r\n            });\r\n        }\r\n        return new HttpHeaders({\r\n            'Content-Type': 'application/json'\r\n        });\r\n    }\r\n}"]},"metadata":{},"sourceType":"module","externalDependencies":[]}